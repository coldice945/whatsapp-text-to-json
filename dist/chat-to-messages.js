var e=require("fs");const s=/(image|audio|video|GIF) omitted$/;function t(e){const s=[8206,8236].map(e=>String.fromCharCode(e));return e.replace(new RegExp(`(${s.join("|")})`,"g"),"").trim()}function r(e){if("["!==e[0])return null;const s=e.slice(7,11),t=parseInt(e.slice(4,6))-1,r=e.slice(1,3),n=e.slice(13,15),i=e.slice(16,18),o=e.slice(19,21);return new Date(s,t,r,n,i,o).toISOString()}function n(e){if(/Messages to this group are now secured with end-to-end encryption./.test(e))return{user:null,messageType:"system",message:"Messages to this group are now secured with end-to-end encryption."};let s=e.indexOf(":");if(s>=0){const t=e.slice(0,s);return{user:t,message:i(e,t),messageType:"message"}}if(s=e.search(/\s(left)/),s>=0)return{user:null,message:e,messageType:"system"};if(s=e.search(/created|added|changed/),s>=0){const t=e.slice(0,s);return{user:"You"===t?"You":t,message:e,messageType:"action"}}return{user:null,message:e,messageType:null}}function i(e,s=""){return e.slice(s.length+2)}const o=process.argv[2],a=process.argv.slice(2),c=a.includes("-m"),l=a.includes("-t");if(!o)throw Error("No filename provided.");let u,g=o.slice(0,-4)+"-messages.json";try{u=function(e,i,o){const a=e.split("\n"),c=[];for(let e=0,l=a.length;e<l;e++){const l=t(a[e]);if(!l.length||!i&&s.test(l)||0===e&&l.indexOf("Messages to this group are now secured with end-to-end encryption.")>=0)continue;const u=r(l.slice(0,22));if(u){const{user:e,messageType:s,message:t}=n(l.slice(23));c.push({date:u,user:e,message:t,...o?{type:s}:{}})}else c[c.length-1].message+="\n"+l}return{data:c}}(e.readFileSync(o,"utf8"),c,l)}catch(e){throw Error("Error loading file. Make sure the filename is correct and target file exists.")}if(!u)throw Error("No data returned.");e.writeFile(g,JSON.stringify(u),e=>{if(e)throw e;console.log("written to "+g+"...")});
//# sourceMappingURL=chat-to-messages.js.map
